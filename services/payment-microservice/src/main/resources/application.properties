spring.application.name=payment-service
server.port=8084

# --- Database configuration ---
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://${MYSQL_HOST:localhost}:3306/paymentservice}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:1234}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# --- HikariCP Connection Pool Configuration ---
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# --- JPA configuration ---
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=true

# --- Eureka ---
eureka.client.service-url.defaultZone=${EUREKA_CLIENT_SERVICEURL_DEFAULTZONE:http://localhost:8761/eureka/}
eureka.instance.prefer-ip-address=true



# ---RabbitMQ ---
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:guest}

# --- RabbitMQ Connection Pool Configuration ---
spring.rabbitmq.listener.simple.concurrency=5
spring.rabbitmq.listener.simple.max-concurrency=10
spring.rabbitmq.listener.simple.prefetch=10
spring.rabbitmq.template.retry.enabled=true
spring.rabbitmq.template.retry.initial-interval=1000
spring.rabbitmq.template.retry.max-attempts=3
spring.rabbitmq.template.retry.multiplier=2


logging.level.org.hibernate.SQL=DEBUG
spring.cloud.compatibility-verifier.enabled=false
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers

# --- JMX Configuration ---
# Disable JMX to avoid "Failed to retrieve application JMX service URL" warning
spring.jmx.enabled=false
management.endpoints.jmx.exposure.exclude=*

# --- JWT Configuration ---
app.jwt.base64-secretkey=${APP_JWT_SECRETKEY:g5rhnoLF2O4S/p5wPKY9ojbK3X2g6ifB6cG9lkaLUg9quMDtO1PSI4J6biyJHZ5uAnyTbuTyaWRpHy+BADU7NQ==}

# --- Security Configuration ---
app.security.enabled=${APP_SECURITY_ENABLED:true}

# --- Resilience4j Circuit Breaker Configuration ---
resilience4j.circuitbreaker.instances.orderService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.orderService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.orderService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.orderService.minimumNumberOfCalls=1
resilience4j.circuitbreaker.instances.orderService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.orderService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.orderService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.orderService.recordExceptions=java.net.ConnectException,java.util.concurrent.TimeoutException,org.springframework.web.reactive.function.client.WebClientException,org.springframework.web.reactive.function.client.WebClientRequestException,org.springframework.web.reactive.function.client.WebClientResponseException,io.netty.channel.ConnectTimeoutException
resilience4j.circuitbreaker.instances.orderService.ignoreExceptions=org.springframework.web.reactive.function.client.WebClientResponseException$Forbidden

resilience4j.circuitbreaker.instances.userService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.userService.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.userService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.userService.minimumNumberOfCalls=1
resilience4j.circuitbreaker.instances.userService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.userService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.userService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.userService.recordExceptions=java.net.ConnectException,java.util.concurrent.TimeoutException,org.springframework.web.reactive.function.client.WebClientException,org.springframework.web.reactive.function.client.WebClientRequestException,org.springframework.web.reactive.function.client.WebClientResponseException,io.netty.channel.ConnectTimeoutException
resilience4j.circuitbreaker.instances.userService.ignoreExceptions=org.springframework.web.reactive.function.client.WebClientResponseException$Forbidden

# --- Resilience4j TimeLimiter Configuration ---
resilience4j.timelimiter.instances.orderService.timeoutDuration=60s
resilience4j.timelimiter.instances.orderService.cancelRunningFuture=true

resilience4j.timelimiter.instances.userService.timeoutDuration=60s
resilience4j.timelimiter.instances.userService.cancelRunningFuture=true

# --- Resilience4j Metrics ---
resilience4j.metrics.enabled=true
resilience4j.circuitbreaker.metrics.enabled=true
resilience4j.circuitbreaker.metrics.tags.enabled=true

# --- Logging for Circuit Breaker ---
logging.level.io.github.resilience4j.circuitbreaker=DEBUG
logging.level.com.example.payment.infrastructure.service.OrderServiceAdapter=DEBUG
logging.level.com.example.payment.infrastructure.service.UserServiceAdapter=DEBUG



