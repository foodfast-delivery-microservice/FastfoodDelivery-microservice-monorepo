spring.application.name=order-service
server.port=8083

# --- Database configuration ---
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://${MYSQL_HOST:localhost}:3306/orderservice}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:1234}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# --- HikariCP Connection Pool Configuration ---
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# --- JPA configuration ---
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.default_batch_fetch_size=50


# --- Eureka ---

eureka.client.service-url.defaultZone=${EUREKA_CLIENT_SERVICEURL_DEFAULTZONE:http://localhost:8761/eureka/}
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true

# ---RabbitMQ ---
# khi nao chay docker thi xoa comment nay va tat localhost
#spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:rabbitmq-broker}
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# --- RabbitMQ Connection Pool Configuration ---
spring.rabbitmq.listener.simple.concurrency=5
spring.rabbitmq.listener.simple.max-concurrency=10
spring.rabbitmq.listener.simple.prefetch=10
spring.rabbitmq.template.retry.enabled=true
spring.rabbitmq.template.retry.initial-interval=1000
spring.rabbitmq.template.retry.max-attempts=3
spring.rabbitmq.template.retry.multiplier=2


app.jwt.base64-secretkey=${APP_JWT_SECRETKEY:g5rhnoLF2O4S/p5wPKY9ojbK3X2g6ifB6cG9lkaLUg9quMDtO1PSI4J6biyJHZ5uAnyTbuTyaWRpHy+BADU7NQ==}

logging.level.org.hibernate.SQL=DEBUG
spring.cloud.compatibility-verifier.enabled=false
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers

# --- JMX Configuration ---
# Disable JMX to avoid "Failed to retrieve application JMX service URL" warning
spring.jmx.enabled=false
management.endpoints.jmx.exposure.exclude=*

# --- Resilience4j Circuit Breaker Configuration ---
resilience4j.circuitbreaker.instances.productService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.productService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.productService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.productService.minimumNumberOfCalls=1
resilience4j.circuitbreaker.instances.productService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.productService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.productService.automaticTransitionFromOpenToHalfOpenEnabled=true

resilience4j.circuitbreaker.instances.userService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.userService.waitDurationInOpenState=5s
resilience4j.circuitbreaker.instances.userService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.userService.minimumNumberOfCalls=1
resilience4j.circuitbreaker.instances.userService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.userService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.userService.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.userService.recordExceptions=java.net.ConnectException,java.util.concurrent.TimeoutException,org.springframework.web.reactive.function.client.WebClientException
resilience4j.circuitbreaker.instances.userService.ignoreExceptions=org.springframework.web.reactive.function.client.WebClientResponseException$Forbidden

# --- Resilience4j TimeLimiter Configuration ---
resilience4j.timelimiter.instances.productService.timeoutDuration=60s
resilience4j.timelimiter.instances.productService.cancelRunningFuture=true

resilience4j.timelimiter.instances.userService.timeoutDuration=60s
resilience4j.timelimiter.instances.userService.cancelRunningFuture=true

resilience4j.circuitbreaker.instances.paymentService.failureRateThreshold=50
resilience4j.circuitbreaker.instances.paymentService.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.paymentService.slidingWindowSize=10
resilience4j.circuitbreaker.instances.paymentService.minimumNumberOfCalls=1
resilience4j.circuitbreaker.instances.paymentService.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.instances.paymentService.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.paymentService.automaticTransitionFromOpenToHalfOpenEnabled=true

resilience4j.timelimiter.instances.paymentService.timeoutDuration=60s
resilience4j.timelimiter.instances.paymentService.cancelRunningFuture=true

# --- Resilience4j Metrics ---
resilience4j.metrics.enabled=true
resilience4j.circuitbreaker.metrics.enabled=true
resilience4j.circuitbreaker.metrics.tags.enabled=true

# --- Logging for Circuit Breaker ---
logging.level.io.github.resilience4j.circuitbreaker=DEBUG
logging.level.com.example.order_service.infrastructure.service.ProductServiceAdapter=DEBUG